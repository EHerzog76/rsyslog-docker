# default permissions for all log files.
#$FileOwner root
#$FileGroup adm
#$FileCreateMode 0640
#$DirCreateMode 0755
#$Umask 0022
#$errormessagestostderr on
global(processInternalMessages="on")

#module(load="imtcp" StreamDriver.AuthMode="anon" StreamDriver.Mode="1")
module(load="imrelp")
module(load="imptcp")
module(load="imudp" TimeRequery="500")

module(load="omstdout")
module(load="omelasticsearch")

module(load="mmjsonparse")
module(load="mmutf8fix")


input(type="imptcp" port="514")
input(type="imudp" port="514")
input(type="imrelp" port="1601")

# includes done explicitely
$IncludeConfig /etc/rsyslog.conf.d/log_to_logsene.conf
$IncludeConfig /etc/rsyslog.conf.d/log_to_files.conf

#################### default ruleset begins ####################

# we emit our own messages to docker console:
syslog.* :omstdout:

$IncludeConfig /config/droprules.conf  # this permits the user to easily drop unwanted messages

action(name="main_utf8fix" type="mmutf8fix" replacementChar="?")

call log_to_files

if `echo $LOGSENE_TOKEN` != "" then
	call log_to_logsene
